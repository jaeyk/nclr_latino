---
title: "EDA"
output:
  html_document:
    df_print: paged
---

# Import pkgs 

```{r}
# Import pkgs
pacman::p_load(
  pdftools,
  tidyverse,
  purrr,
  furrr,
  tm,
  here,
  tidytext, # text analysis 
  SnowballC, # stemming 
  textclean, # text preprocessing 
  ggthemes,
  text2vec, # word embedding 
  widyr,
  patchwork, # arranging ggplots
  glue,
  # deep learning 
  text2vec
)

theme_set(theme_clean())

source(here("functions", "utils.r"))
```

# Import files 

```{r}
load(file = here("processed_data/processed_text.Rdata"))

# Remove unnecessary files 
rm(list = ls()[grep("tf_idf", ls())])
```

The following code is adapted from: https://cbail.github.io/textasdata/word2vec/rmarkdown/word2vec.html

# Preprocessing data 

```{r}
data("stop_words")

# Remove noise 
df_clean <- df %>%
  mutate(value = value %>%
           # Remove stopwords 
           tm::removeWords(words = stop_words$word) %>%
           # Remove excessive white space
           str_squish()) 
```

The following code was adapted from http://text2vec.org/glove.html

# Building and training model 

```{r}
word_vectors_nclr <- df2vec(df_clean)
```

## Inspecting related words using word embedding

- Hispanic 

```{r}
dina_key_words <- c("minority", "collective", "race", "racism", "discrimination", "solidarity", "community", "recognition", "movement", "identity", "streotype", "assimilation", "negative", "white", "black", "negro", "hispanic", "puerto", "brown")

jae_key_words <- c("invisible", "unity", "census", "federal", "government", "policy", "absence")

keywords <- c(dina_key_words, jae_key_words)
```

```{r}
out <- vec2sim(word_vectors, "identity", 20)
  
embed_out_nclr <- purrr::map_dfr(keywords, 
  possibly(~vec2sim(word_vectors_nclr, ., 20),
           # This sorts out the keyword not in the word embedding
    otherwise = 
      data.frame(word = NA, 
                 similarity = NA, 
                 keyword = NA)))
```

## Plotting the results 

```{r}
plot_embed(embed_out_nclr)

ggsave(here("outputs", "embed_plot_nclr_glove.png"), height = 9, width = 12)
```